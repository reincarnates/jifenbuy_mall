
const list = [
  {
    "store_name": "供应商测试001",
    "store_id": 31,
    "list": [
      {
        "cart_id": 1282,
        "buyer_id": 1,
        "store_id": 31,
        "store_name": "供应商测试001",
        "goods_id": "ZY3c9148d135",
        "goods_name": "满199减120_百草味 坚果大礼包1368g/8袋 每日坚果礼盒零食 夏威夷果碧根果等 MJ",
        "goods_price": "88.00",
        "goods_num": 1,
        "goods_image": "http://test.fulibuy.cn/upload/picture/goodsImage/20190710/a9afacb9e2801499adde30dd7dcef897.jpg",
        "bl_id": 0,
        "goods_sku": "ZY3c9148d135",
        "yggc_sku": "",
        "goods_state": 1,
        "stock": [],
        "goods_total": "88.00"
      }
    ]
  },
  {
    "store_name": "YGGC商城",
    "store_id": 28,
    "list": [
      {
        "cart_id": 1287,
        "buyer_id": 1,
        "store_id": 28,
        "store_name": "YGGC商城",
        "goods_id": "ecdb9f6a96",
        "goods_name": "耐司（NiSi）MC UV 95mm UV镜 双面多层镀膜无暗角 单反uv镜 保护镜 单反滤镜 滤光镜 佳能尼康相机滤镜",
        "goods_price": "264.00",
        "goods_num": 1,
        "goods_image": "http://img11.360buyimg.com/n1/jfs/t5929/150/6044560460/53480/c3c30244/596f0b85N3eb3444d.jpg",
        "bl_id": 0,
        "goods_sku": "ecdb9f6a96",
        "yggc_sku": "jd_personal_1003829",
        "goods_state": 1,
        "stock": [
          {
            "goods_sku_id": 114436,
            "goods_sku": "ecdb9f6a96",
            "goods_id": 114436,
            "goods_name": "耐司（NiSi）MC UV 95mm UV镜 双面多层镀膜无暗角 单反uv镜 保护镜 单反滤镜 滤光镜 佳能尼康相机滤镜",
            "goods_price": "264.00",
            "goods_marketprice": "264.00",
            "goods_image": "http://img11.360buyimg.com/n1/jfs/t5929/150/6044560460/53480/c3c30244/596f0b85N3eb3444d.jpg",
            "goods_unit": "件",
            "goods_storage": 100,
            "spu": "ecdb9f6a96"
          }
        ],
        "goods_total": "264.00"
      },
      {
        "cart_id": 1289,
        "buyer_id": 1,
        "store_id": 28,
        "store_name": "YGGC商城",
        "goods_id": "8e87427dd6",
        "goods_name": "Samsonite/新秀丽韩版休闲旅行背包女 13英寸商务电脑包拉链双肩包BP2*28002浅灰色",
        "goods_price": "379.00",
        "goods_num": 1,
        "goods_image": "http://img11.360buyimg.com/n1/jfs/t18322/89/1433264582/361827/cc5849b7/5ac9a0d7N40eb3dec.jpg",
        "bl_id": 0,
        "goods_sku": "8e87427dd6",
        "yggc_sku": "jd_personal_100001736149",
        "goods_state": 1,
        "stock": [
          {
            "goods_sku_id": 44628,
            "goods_sku": "8e87427dd6",
            "goods_id": 44628,
            "goods_name": "Samsonite/新秀丽韩版休闲旅行背包女 13英寸商务电脑包拉链双肩包BP2*28002浅灰色",
            "goods_price": "379.00",
            "goods_marketprice": "379.00",
            "goods_image": "http://img11.360buyimg.com/n1/jfs/t18322/89/1433264582/361827/cc5849b7/5ac9a0d7N40eb3dec.jpg",
            "goods_unit": "件",
            "goods_storage": 100,
            "spu": "8e87427dd6"
          }
        ],
        "goods_total": "379.00"
      },
      {
        "cart_id": 1312,
        "buyer_id": 1,
        "store_id": 28,
        "store_name": "YGGC商城",
        "goods_id": "1d84795745",
        "goods_name": "金河田KM021彩虹湾游戏键盘鼠标套装 键鼠套装 办公鼠标键盘套装 七彩背光机械手感有线键盘电脑键盘 白色",
        "goods_price": "36.01",
        "goods_num": 1,
        "goods_image": "http://img11.360buyimg.com/n1/jfs/t7294/2/2879577919/293420/16506df2/59b5eeffN2ae1fa0d.jpg",
        "bl_id": 0,
        "goods_sku": "1d84795745",
        "yggc_sku": "jd_personal_5028785",
        "goods_state": 1,
        "stock": [
          {
            "goods_sku_id": 34605,
            "goods_sku": "1d84795745",
            "goods_id": 34605,
            "goods_name": "金河田KM021彩虹湾游戏键盘鼠标套装 键鼠套装 办公鼠标键盘套装 七彩背光机械手感有线键盘电脑键盘 白色",
            "goods_price": "36.01",
            "goods_marketprice": "45.00",
            "goods_image": "http://img11.360buyimg.com/n1/jfs/t7294/2/2879577919/293420/16506df2/59b5eeffN2ae1fa0d.jpg",
            "goods_unit": "件",
            "goods_storage": 100,
            "spu": "1d84795745"
          }
        ],
        "goods_total": "36.01"
      },
      {
        "cart_id": 1427,
        "buyer_id": 1,
        "store_id": 28,
        "store_name": "YGGC商城",
        "goods_id": "1566474581",
        "goods_name": "伊利奶粉 金领冠系列 婴儿配方奶粉 1段400克（0-6个月婴儿适用）新老包装随机发货",
        "goods_price": "60.20",
        "goods_num": 1,
        "goods_image": "http://img11.360buyimg.com/n1/jfs/t19231/365/811688584/207102/892d6cb8/5aa8f881N0fa37b98.jpg",
        "bl_id": 0,
        "goods_sku": "1566474581",
        "yggc_sku": "jd_personal_497495",
        "goods_state": 1,
        "stock": [
          {
            "goods_sku_id": 684452,
            "goods_sku": "1566474581",
            "goods_id": 684451,
            "goods_name": "伊利奶粉 金领冠系列 婴儿配方奶粉 1段400克（0-6个月婴儿适用）新老包装随机发货",
            "goods_price": "60.20",
            "goods_marketprice": "60.20",
            "goods_image": "http://img11.360buyimg.com/n1/jfs/t19231/365/811688584/207102/892d6cb8/5aa8f881N0fa37b98.jpg",
            "goods_unit": "件",
            "goods_storage": 100,
            "spu": "1566474581"
          }
        ],
        "goods_total": "60.20"
      }
    ]
  },
  {
    "list": [
      {
        "cart_id": 1282,
        "buyer_id": 1,
        "store_id": 31,
        "store_name": "供应商测试001",
        "goods_id": "ZY3c9148d135",
        "goods_name": "满199减120_百草味 坚果大礼包1368g/8袋 每日坚果礼盒零食 夏威夷果碧根果等 MJ",
        "goods_price": "88.00",
        "goods_num": 1,
        "goods_image": "http://test.fulibuy.cn/upload/picture/goodsImage/20190710/a9afacb9e2801499adde30dd7dcef897.jpg",
        "bl_id": 0,
        "goods_sku": "ZY3c9148d135",
        "yggc_sku": "",
        "goods_state": 1,
        "stock": [
          {
            "goods_sku_id": 2800007,
            "goods_sku": "ZY3c9148d135",
            "goods_id": 2800004,
            "goods_name": "满199减120_百草味 坚果大礼包1368g/8袋 每日坚果礼盒零食 夏威夷果碧根果等 MJ",
            "goods_price": "88.00",
            "goods_marketprice": "54.99",
            "goods_image": "http://test.fulibuy.cn/upload/picture/goodsImage/20190710/a9afacb9e2801499adde30dd7dcef897.jpg",
            "goods_unit": "件",
            "goods_storage": 1000,
            "spu": "ZY3c9148d135"
          }
        ],
        "goods_total": "88.00"
      }
    ],
    "store_name": "供应商测试001",
    "store_id": 31
  }
]

// pages/shopCart/shopCart.js
Page({

  /**
   * 页面的初始数据
   */
  data: {
    cardTeams: list,
    checked_all: false, //全选
    newArr: [], //复选框选中
    countMoney: 0, //结算价格
    countNum: 0,
    goodsNum: 0,
    cardTeamsLen: [],
    selectedAll: false,
    shopSelect: false,
    manage: '管理',
    mState: 1,
    settState: true,
    oper: false,
    classState: true,
    num: 1,
    zonglength: 0, //总条目
    yixuanlength: 0, //已选条目
    invalidArr: [], //失效商品
    invState: true,
    isGoods: true,
  },

  // 购物车+
  getPlus: function(e) {
    var that = this;
    var cardTeams = that.data.cardTeams;
    var key = e.currentTarget.dataset.key;
    var index = e.currentTarget.dataset.index;
    // console.log(index)
    var goods_num = cardTeams[key].list[index].goods_num;
    var maxNum = cardTeams[key].list[index].stock;
    for (var i = 0; i < maxNum.length; i++) {
      if (cardTeams[key].list[index].goods_sku == maxNum[i].goods_sku) {
        if (cardTeams[key].list[index].goods_num < maxNum[i].goods_storage) {
          goods_num++
        } else if (cardTeams[key].list[index].goods_num == maxNum[i].goods_storage) {
          wx.showToast({
            title: '没有库存了哦~',
            icon: 'none',
            duration: 2000
          })
        }
      }
    }

    cardTeams[key].list[index].goods_num = goods_num;
    that.setData({
      cardTeams: cardTeams
    })
    that.getTotalPrice();
  },
  // 购物车-
  getMain: function(e) {
    var that = this;
    var cardTeams = that.data.cardTeams;
    var key = e.currentTarget.dataset.key;
    var index = e.currentTarget.dataset.index;
    // console.log(index)

    if (cardTeams[key].list[index].goods_num > 1) {
      // cardTeams[key].list[index].goods_num = 1
      // that.delItem(e)
      cardTeams[key].list[index].goods_num--;
    }
    // console.log(cardTeams[key].list[index].goods_num)
    that.setData({
      cardTeams: cardTeams
    })
    that.getTotalPrice();
  },
  // 单选
  goodsdagou: function(e) {
    var that = this;

    // 本身
    var cardtanmess = 'cardTeams[' + e.target.dataset.fuindex + '].list[' + e.target.dataset.index + '].is_xuan';
    // 父级别
    var fucardtanmess = 'cardTeams[' + e.target.dataset.fuindex + '].lengths';
    if (that.data.cardTeams[e.target.dataset.fuindex].list[e.target.dataset.index].is_xuan == 0) {
      that.setData({
        [cardtanmess]: 1,
        [fucardtanmess]: that.data.cardTeams[e.target.dataset.fuindex].lengths + 1,
        yixuanlength: that.data.yixuanlength + 1,
        selectGoods: that.data.cardTeams[e.target.dataset.fuindex].list[e.target.dataset.index],
        selectIndex: e.target.dataset.fuindex
      });
    } else if (that.data.cardTeams[e.target.dataset.fuindex].list[e.target.dataset.index].is_xuan == 1) {
      that.setData({
        [cardtanmess]: 0,
        [fucardtanmess]: that.data.cardTeams[e.target.dataset.fuindex].lengths - 1,
        yixuanlength: that.data.yixuanlength - 1,
        selectGoods: '',
        selectIndex: 0
      });
    };

    var num = that.data.num;
    var cardTeams = that.data.cardTeams;
    var cardTeamsLen = that.data.cardTeamsLen;
    var index = e.currentTarget.dataset.checkid;
    var key = e.currentTarget.dataset.key;
    var arr = that.data.newArr;
    var selected = cardTeams[key].list[index].selected;
    cardTeams[key].list[index].selected = !selected;
    if (!selected) {
      arr.push(cardTeams[key].list[index].cart_id);
      this.setData({
        classState: false
      });
    } else {
      var _index = arr.indexOf(cardTeams[key].list[index].cart_id);
      arr.splice( _index, 1);
      if (arr.length == 0) {
        this.setData({
          classState: true
        });
      }
    };

    if (arr.length == cardTeamsLen.length) {
      that.setData({
        checked_all: true,
        selectedAll: true
      })
      cardTeams[key].shopSelect = true;
    } else {
      that.setData({
        checked_all: false,
        selectedAll: false
      })
    };

    that.setData({
      cardTeams: cardTeams,
      newArr: arr
    });

    that.getTotalPrice();
  },
  // 全选
  checkedAll: function() {
    var that = this;

    // 父级别
    if (that.data.yixuanlength != that.data.zonglength) {
      for (var i = 0; i < that.data.cardTeams.length; i++) {
        var fucardtanmess = 'cardTeams[' + i + '].lengths'
        var fucardtanmezz = that.data.cardTeams[i].lengthz
        for (var j = 0; j < that.data.cardTeams[i].list.length; j++) {
          var cardtanmess = 'cardTeams[' + i + '].list[' + j + '].is_xuan'
          this.setData({
            [cardtanmess]: 1,
            [fucardtanmess]: fucardtanmezz,
            yixuanlength: that.data.zonglength
          });
        }
      };
    } else {
      for (var i = 0; i < that.data.cardTeams.length; i++) {
        var fucardtanmess = 'cardTeams[' + i + '].lengths'
        var fucardtanmezz = that.data.cardTeams[i].lengthz
        for (var j = 0; j < that.data.cardTeams[i].list.length; j++) {
          var cardtanmess = 'cardTeams[' + i + '].list[' + j + '].is_xuan'
          this.setData({
            [cardtanmess]: 0,
            [fucardtanmess]: 0,
            yixuanlength: 0
          });
        }
      };
    }

    var cardTeams = that.data.cardTeams;
    var arr = [];
    for (var i = 0; i < cardTeams.length; i++) {
      for (var j = 0; j < cardTeams[i].list.length; j++) {
        if (cardTeams[i].list[j].is_xuan == 1) {
          arr.push(cardTeams[i].list[j].cart_id);
          cardTeams[i].lengths = cardTeams[i].lengthz;
          this.setData({
            classState: false,
            checked_all: true
          });
        } else {
          arr = [];
          cardTeams[i].lengths = 0;
          this.setData({
            classState: true,
            checked_all: false
          });
        };
      }
    };
    that.setData({
      cardTeams: cardTeams,
      newArr: arr
    });

    that.getTotalPrice();
  },
  //店铺全选
  checkedShopAll: function(e) {
    var that = this;
    var cardTeams = that.data.cardTeams;
    // 父级别
    var fucardtanmess = 'cardTeams[' + e.target.dataset.indes + '].lengths';
    if (that.data.cardTeams[e.target.dataset.indes].lengthz == that.data.cardTeams[e.target.dataset.indes].lengths) {
      that.setData({
        yixuanlength: that.data.yixuanlength - that.data.cardTeams[e.target.dataset.indes].lengthz
      })

      for (var i = 0; i < that.data.cardTeams[e.target.dataset.indes].lengthz; i++) {
        var cardtanmess = 'cardTeams[' + e.target.dataset.indes + '].list[' + i + '].is_xuan';
        that.setData({
          [cardtanmess]: 0
        });
      };

      for (let i = 0; i < cardTeams[e.target.dataset.indes].list.length; i++) {
        if (cardTeams[e.target.dataset.indes].list[i].is_xuan != 1) {
          var id = cardTeams[e.target.dataset.indes].list[i].cart_id;
          var _index = that.data.newArr.indexOf(id);
          that.data.newArr.splice(_index, 1);
        }
      }
      
      that.setData({
        [fucardtanmess]: 0,
        newArr: that.data.newArr,
      });

      that.getTotalPrice();
    } else {
      that.setData({
        yixuanlength: that.data.yixuanlength - that.data.cardTeams[e.target.dataset.indes].lengths + that.data.cardTeams[e.target.dataset.indes].lengthz
      });

      for (var i = 0; i < that.data.cardTeams[e.target.dataset.indes].lengthz; i++) {
        var cardtanmess = 'cardTeams[' + e.target.dataset.indes + '].list[' + i + '].is_xuan';
        that.setData({
          [cardtanmess]: 1
        });
      };

      var len = that.data.cardTeams[e.target.dataset.indes].list;
      for (var i = 0; i < len.length; i++) {
        that.data.newArr.push(len[i].cart_id);
      }

      that.setData({
        [fucardtanmess]: that.data.cardTeams[e.target.dataset.indes].lengthz,
        newArr: that.data.newArr,
      });

      that.setData({
        yixuanlength: that.data.yixuanlength - that.data.cardTeams[e.target.dataset.indes].lengths + that.data.cardTeams[e.target.dataset.indes].lengthz
      });

      that.getTotalPrice();
    };
  },
  //管理
  manageClick: function() {
    var state = this.data.mState;
    if (state == 1) {
      this.setData({
        manage: '完成',
        mState: 2,
        settState: false,
        oper: true
      });
    } else {
      this.setData({
        manage: '管理',
        mState: 1,
        settState: true,
        oper: false
      });
    }
  },
  jkl: function() {
    console.log(1);
  },
  // 计算商品价格
  getTotalPrice() {
    var cardTeams = this.data.cardTeams;
    var total = 0;
    var totalNum = 0;
    for (var i = 0; i < cardTeams.length; i++) {
      for (var j = 0; j < cardTeams[i].list.length; j++) {
        if (cardTeams[i].list[j].is_xuan == 1) {
          total += cardTeams[i].list[j].goods_num * cardTeams[i].list[j].goods_price;
          totalNum += cardTeams[i].list[j].goods_num;
        }
      }
    }
    this.setData({
      cardTeams: cardTeams,
      countMoney: total.toFixed(2),
      countNum: totalNum
    })
  },
  // 删除
  delItem: function(e) {
    var that = this;
    var index = e.currentTarget.dataset.index;
    var key = e.currentTarget.dataset.key;
    const cardTeams = that.data.cardTeams;
    wx.showModal({
      title: '提示',
      content: '确定删除吗？',
      cancelText: '否',
      confirmText: '是',
      success: function(res) {
        if (res.confirm) {
          var _index = cardTeams[key].list.indexOf(cardTeams[key].list[index]);
          cardTeams[key].list.splice(_index, 1);
          if (cardTeams[key].list.length != 0) {
            cardTeams[key].lengthz = cardTeams[key].list.length;
          }
          if (cardTeams[key].list.length == 0) {
            cardTeams.splice(key, 1);
          }
          if (that.data.invalidArr.length == 0 && that.data.cardTeams == 0) {
            that.setData({
              isGoods: false
            });
          }
          var aasindex = 0;
          for (var k = 0; k < cardTeams.length; k++) {
            for (var l = 0; l < cardTeams[k].list.length; l++) {
              aasindex++;
              that.setData({
                zonglength: aasindex
              });
            }
          }
          that.setData({
            cardTeams: cardTeams,
          });
          that.getTotalPrice();
        }
      }
    })
  },
  //操作删除
  semDelItem: function() {
    var _this = this;
    var cardTeams = this.data.cardTeams;
    var selectIndex = this.data.selectIndex;
    //全部选中删除
    if (_this.data.yixuanlength == _this.data.zonglength) {
      wx.showModal({
        title: '提示',
        content: '确定删除吗？',
        cancelText: '否',
        confirmText: '是',
        success: function (res) {
          if (res.confirm) {
            _this.setData({
              cardTeams: [],
              manage: '管理',
              yixuanlength: 0,
              zonglength: 0,
            });
            if (_this.data.invalidArr.length == 0) {
              _this.setData({
                isGoods: false
              });
            }
          }
        }
      })
    }
    // //选中一个删除
    // if (_this.data.yixuanlength == 1) {
    //   if (_this.data.zonglength != 1) {
    //     wx.showModal({
    //       title: '提示',
    //       content: '确定删除吗？',
    //       cancelText: '否',
    //       confirmText: '是',
    //       success: function (res) {
    //         if (res.confirm) {
    //           var _index = cardTeams[selectIndex].list.indexOf(_this.data.selectGoods);
    //           cardTeams[selectIndex].list.splice(_index, 1);
    //           _this.setData({
    //             cardTeams: cardTeams,
    //             zonglength: cardTeams[selectIndex].list.length,
    //             yixuanlength: 0
    //           });
    //         }
    //       }
    //     })
    //   }
    // }
    //选中两个以上删除
    if (_this.data.yixuanlength >= 1) {
      if (_this.data.yixuanlength != _this.data.zonglength) {
        wx.showModal({
          title: '提示',
          content: '确定删除吗？',
          cancelText: '否',
          confirmText: '是',
          success: function (res) {
            if (res.confirm) {
              
              for (var i = 0; i < cardTeams.length; i++) {
                for (var j = cardTeams[i].list.length; j > 0; j--) {
                  if (cardTeams[i].list[j-1].is_xuan == 1) {
                    var _index = cardTeams[i].list.indexOf(cardTeams[i].list[j - 1]);
                    cardTeams[i].list.splice(_index, 1);
                    _this.setData({
                      cardTeams: cardTeams,
                    });
                    
                    console.log(cardTeams);
                    var aasindex = 0;
                    for (var k = 0; k < cardTeams.length; k++) {
                      for (var l = 0; l < cardTeams[k].list.length; l++) {
                        aasindex++;
                        _this.setData({
                          zonglength: aasindex,
                          yixuanlength: 0
                        });
                      }
                    }
                  }
                }
              }
            }
          }
        })
      }
    }
  },
  //清理失效商品
  clearInvalid: function() {
    this.setData({
      invalidArr: [],
      invState: false
    });
    if (this.data.invalidArr.length == 0 && this.data.cardTeams == 0) {
      this.setData({
        isGoods: false
      });
    }
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function(options) {
   
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function() {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function(e) {
    var that = this;
    var cardTeams = that.data.cardTeams;
    var arr = that.data.newArr;
    var arr2 = [];
    var arr3 = [];
    var zlength = 0
    for (var i = 0; i < cardTeams.length; i++) {
      cardTeams[i].lengthz = cardTeams[i].list.length;
      cardTeams[i].lengths = 0;
      for (var j = 0; j < cardTeams[i].list.length; j++) {
        if (cardTeams[i].list[j].stock.length != 0) {
          zlength++;
          that.setData({
            zonglength: zlength
          });
        }
        that.data.cardTeamsLen.push(cardTeams[i].list.length);
        // cardTeams[i].list[j].is_xuan = false;
        if (cardTeams[i].list[j].stock.length == 0) {
          cardTeams[i].errorState = true;
        }else{
          cardTeams[i].errorState = false;
        }
        
        if (cardTeams[i].list[j].stock.length == 0) {
          cardTeams[i].fstock = [];
        }
        
        if (that.data.checked_all) {
          cardTeams[i].list[j].is_xuan = 1;
          // cardTeams[i].shopSelect = true;
          arr.push(cardTeams[i].list[j].cart_id);
        } else {
          cardTeams[i].list[j].is_xuan = 0;
          // cardTeams[i].shopSelect = false;
          arr = [];
        }
      }

      if (cardTeams[i].fstock != undefined) {
        arr2.push(cardTeams[i]);
      }else{
        arr3.push(cardTeams[i]);
      }
    }

    that.setData({
      cardTeams: arr3,
      newArr: arr,
      invalidArr: arr2,
    });

    that.getTotalPrice(); //合计
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function() {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function() {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function() {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function() {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function() {

  },
  //滑动删除
  //手指触摸动作开始 记录起点X坐标
  touchstart: function(e) {
    // var index = e.currentTarget.dataset.checkid;
    var key = e.currentTarget.dataset.key;
    //开始触摸时 重置所有删除
    this.data.cardTeams[key].list.forEach(function(v, i) {
      if (v.isTouchMove) //只操作为true的
        v.isTouchMove = false;
    });
    this.setData({
      startX: e.changedTouches[0].clientX,
      startY: e.changedTouches[0].clientY,
      cardTeams: this.data.cardTeams
    })
  },
  //滑动事件处理
  touchmove: function(e) {
    var that = this,
      index = e.currentTarget.dataset.index, //当前索引
      startX = that.data.startX, //开始X坐标
      startY = that.data.startY, //开始Y坐标
      touchMoveX = e.changedTouches[0].clientX, //滑动变化坐标
      touchMoveY = e.changedTouches[0].clientY, //滑动变化坐标
      //获取滑动角度
      angle = that.angle({
        X: startX,
        Y: startY
      }, {
        X: touchMoveX,
        Y: touchMoveY
      });

    var key = e.currentTarget.dataset.key;
    that.data.cardTeams[key].list.forEach(function(v, i) {
      v.isTouchMove = false

      //滑动超过30度角 return
      if (Math.abs(angle) > 30) return;
      if (i == index) {
        if (touchMoveX > startX) //右滑
          v.isTouchMove = false
        else //左滑
          v.isTouchMove = true
      }

    })
    //更新数据
    // console.log(that.data.cardTeams)
    that.setData({
      cardTeams: that.data.cardTeams
    })

  },
  angle: function(start, end) {
    var _X = end.X - start.X,
      _Y = end.Y - start.Y
    //返回角度 /Math.atan()返回数字的反正切值
    return 360 * Math.atan(_Y / _X) / (2 * Math.PI);
  },
  drawEnd: function() {

  }
})